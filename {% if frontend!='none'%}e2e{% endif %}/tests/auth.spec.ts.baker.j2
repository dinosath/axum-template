{% if authentication != 'none' -%}
import { test, expect } from '@playwright/test';

test.describe('Authentication', () => {
  test('shows login page when not authenticated', async ({ page }) => {
    await page.goto('/');
    
    // Should show login form
    await expect(page.getByRole('heading', { name: /sign in/i })).toBeVisible();
  });

  test('shows login and register tabs', async ({ page }) => {
    await page.goto('/');
    
    await expect(page.getByRole('tab', { name: /sign in/i })).toBeVisible();
    await expect(page.getByRole('tab', { name: /register/i })).toBeVisible();
  });

  test('shows error on invalid login', async ({ page }) => {
    await page.goto('/');
    
    await page.getByLabel(/email/i).fill('invalid@test.com');
    await page.getByLabel(/password/i).fill('wrongpassword');
    await page.getByRole('button', { name: /sign in/i }).click();
    
    // Should show error notification
    await expect(page.locator('[role="alert"], .Toastify, [data-sonner-toast]')).toBeVisible({ timeout: 10000 });
  });

  test('logs in with valid admin credentials', async ({ page }) => {
    const adminPassword = process.env.ADMIN_PASSWORD || 'testpassword';
    
    await page.goto('/');
    
    await page.getByLabel(/email/i).fill('admin');
    await page.getByLabel(/password/i).fill(adminPassword);
    await page.getByRole('button', { name: /sign in/i }).click();
    
    // Should redirect to dashboard after login
    await expect(page.getByText(/dashboard/i)).toBeVisible({ timeout: 10000 });
  });

  test('can register a new user', async ({ page }) => {
    const randomEmail = `test${Date.now()}@example.com`;
    
    await page.goto('/');
    
    await page.getByRole('tab', { name: /register/i }).click();
    
    await page.getByLabel(/^email$/i).fill(randomEmail);
    await page.locator('input[name="password"]').first().fill('testpassword123');
    await page.getByLabel(/confirm password/i).fill('testpassword123');
    await page.getByRole('button', { name: /create account/i }).click();
    
    // Should either show success or redirect
    await expect(
      page.getByText(/success|dashboard|welcome/i).or(page.locator('[role="alert"]'))
    ).toBeVisible({ timeout: 10000 });
  });

  test('can logout after login', async ({ page }) => {
    const adminPassword = process.env.ADMIN_PASSWORD || 'testpassword';
    
    await page.goto('/');
    
    // Login first
    await page.getByLabel(/email/i).fill('admin');
    await page.getByLabel(/password/i).fill(adminPassword);
    await page.getByRole('button', { name: /sign in/i }).click();
    
    await expect(page.getByText(/dashboard/i)).toBeVisible({ timeout: 10000 });
    
    // Find and click logout
    const userMenu = page.locator('[data-testid="user-menu"], button:has-text("admin"), [aria-label*="user"]');
    if (await userMenu.isVisible()) {
      await userMenu.click();
      await page.getByRole('menuitem', { name: /logout|sign out/i }).click();
    } else {
      await page.getByRole('button', { name: /logout|sign out/i }).click();
    }
    
    // Should redirect to login page
    await expect(page.getByRole('heading', { name: /sign in/i })).toBeVisible({ timeout: 10000 });
  });
});
{% else -%}
import { test, expect } from '@playwright/test';

test.describe('No Authentication', () => {
  test('loads dashboard without login', async ({ page }) => {
    await page.goto('/');
    
    // Should show dashboard directly
    await expect(page.getByText(/dashboard/i)).toBeVisible({ timeout: 10000 });
  });
});
{% endif -%}
